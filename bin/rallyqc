#!/usr/bin/env ruby
$LOAD_PATH << File.join(Dir.pwd, 'lib')  # shouldn't be needed if this is a gem - keep if testing in source
require "rally_qc_utils"

#example call should be rallyqc --create spreadsheetname config.xml 
#                       rallyqc --generate spreadsheet location

begin
  util = nil
  benchmark = Benchmark.measure do
    util = :RallyQCUtils::RallyQCUtil.new(ARGV)
    util.run  #if util.ready_to_run
  end.real
  util.logger.info "service run took #{benchmark} seconds" if util && util.logger
rescue Exception => ex
  exit if ex.is_a?(SystemExit)
  msg = "There was an error running the utility #{ex.class}.\n"
  msg << "Message was #{ex.message}\n"
  msg << "#{ex.backtrace.join("\n  ")}\n"
  util.logger.error msg if util && util.logger
  puts msg
end